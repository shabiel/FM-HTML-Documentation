<!DOCTYPE HTML PUBLIC "-//SQ//DTD HTML 2.0 HoTMetaL + extensions//EN" "hmpro6.dtd">
<html><head>
<!--VHA OI Health Systems Design & Development (HSD&D)--><!--Oakland OIFO--><!--Authored by Thom Blom and Kyle Clarke, 12/31/99--><!--Revised by Thom Blom, 06/27/03--><!--Edited March 2007, Hardhats.org-->
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>VA FileMan V. 22.0 Advanced User Manual: Auditing a Data
Field</title>

<meta name="subject" content="VA FileMan V. 22.0 Advanced User HTML Manual">
<meta name="keywords" content="information infrastructure service,iis,Infrastructure and Security Services,Infrastructure Security Services,ISS,vista,fileman,va fileman,user,advanced user manual,auditing,audit,data filed,field,audit a data field,tracking,trail">
<link rel="StyleSheet" type="text/css" href="user.css">
</head>
<body topmargin="0" style="background-color: white;">
<br>
<img src="common/fileman_au_heading.gif" alt="VA FileMan V. 22.0 Getting Started HTML Manual Banner" border="0" height="29" width="429"> <br>
<hr align="left" color="blue" width="429"> <br>
<p>&nbsp;</p>
<table class="tdstyle" summary="This table is for formatting purposes only" valign="TOP" border="0" cellpadding="3" cellspacing="0" height="1" width="100%">
<tbody>
<tr>
<td class="menubartext" align="left" height="1" valign="bottom" width="10%">Contents:</td>
<td align="left" height="1" valign="bottom" width="7%"> <a href="index.htm" target="_top" title="VA FileMan V. 22.0 Advanced User HTML Manual: Main Table of Contents" class="menubarlink">Main</a> </td>
<td align="left" height="1" valign="bottom" width="17%"><a href="au_frm.htm" target="_top" class="menubarlink" title="VA FileMan V. 22.0 Advanced User HTML Manual: Auditing Chapter TOC">Chapter</a></td>
<td class="menubartext" align="left" height="1" valign="bottom" width="10%">See Also: </td>
<td align="left" height="1" valign="bottom" width="28%"><a href="../u1/index.htm" target="_top" title="VA FileMan V. 22.0 Getting Started HTML Manual" class="menubarlink">Getting Started Manual</a></td>
<td colspan="4" align="left" height="1" valign="bottom" width="28%"> <a href="../pm/index.htm" target="_top" title="VA FileMan V. 22.0 Programmer HTML Manual" class="menubarlink">Programmer Manual</a></td>
</tr>
</tbody>
</table>
<!-- Content -->
<h3><a name="navskip">Auditing</a></h3>
<hr class="hrstyle">
<h4><big><big>Auditing a Data Field</big></big></h4>
<ul>
<li><a href="#Overview" title="Overview" class="bodylink">Overview</a><br>
<br>
</li>
<li><a href="#Setting" title="Setting a Data Field Audit" class="bodylink">Setting
a Data Field Audit</a><br>
<br>
</li>
<li><a href="#Turning" title="Turning Data Field Audit On/Off" class="bodylink">Turning
Data Field Audit On/Off</a><br>
<br>
</li>
<li><a href="#Reviewing" title="Reviewing the Data Field Audit Trail" class="bodylink">Reviewing
the Data Field Audit Trail</a><br>
<br>
</li>
<li><a href="#Tracking" title="Tracking Data Field Audits" class="bodylink">Tracking
Data Field Audits</a><br>
<br>
</li>
<li><a href="#Purging" title="Purging a Data Field Audit Trail" class="bodylink">Purging
a Data Field Audit Trail</a></li>
</ul>
<hr>
<h5><big><big><a name="Overview">Overview</a></big></big></h5>
<p> The "ENTER OR EDIT FILE ENTRIES" option is used to add,
change,
or delete data values. For example, an admission clerk might use the
Enter or Edit File Entries option to enter a Date of Birth of&nbsp;
'JAN 20, 1949' for patient Richard Green. Later, a nurse could use the
same option to change the value to 'JAN 20, 1950'. You might like to
know who made the successive changes and when; the data field audit
capability is designed to record this information. </p>
<p>When changes like the ones mentioned above are made to an
audited field, the date and time the change was made, the user's name,
and the old and new data values are stored in the AUDIT file (#1.1). In
other words, starting an audit on a data field provides an ongoing
chronological list of who made what changes to data values of fields
you are auditing.</p>
<hr>
<h5><big><big><a name="Setting">Setting
a Data Field Audit</a></big></big></h5>
<p> To begin auditing data changes in a field, use the Modify
File Attributes option, choose the file and fields that should be
audited and answer YES or EDITED to the "AUDIT:" prompt. The possible
responses to the "AUDIT:" prompt are: </p>
<table summary="Setting a Data Field Audit Table (field audit responce, description)" border="1" width="100%">
<tbody>
<tr>
<td valign="top"><b>Response</b></td>
<td valign="top"><b>Description</b></td>
</tr>
<tr>
<td valign="top"><b>YES, ALWAYS</b></td>
<td valign="top">Indicates the audit will occur when
data is initially entered, changed or deleted. </td>
</tr>
<tr>
<td valign="top"><b>EDITED OR DELETED</b></td>
<td valign="top">Means that the audit only occurs
when changes are made or values deleted (<i>not</i> when
the data is initially entered). </td>
</tr>
<tr>
<td valign="top"><b>NO</b></td>
<td valign="top">Turns the audit off. </td>
</tr>
<tr>
<td valign="top"><b>@</b></td>
<td valign="top">Deletes the current audit status
(effectively turning audit off), not the field. </td>
</tr>
</tbody>
</table>
<p>The following example initiates a Data Field audit on the DATE
OF BIRTH field of the PATIENT file (#2). Only changes to pre-existing
data will be recorded: </p>
<hr>
<pre>Select OPTION: <b>MOD</b>IFY FILE ATTRIBUTES<br>DO YOU WANT TO USER THE SCREEN-MODE VERSION? Yes// <b>N </b> (No)<br><br>MODIFY WHAT FILE: <b>PATIENT</b><br>Select FIELD: <b>DATE OF BIRTH</b><br>LABEL: <b></b><br>TITLE: <b></b><br>AUDIT: <b>EDITED </b> EDITED OR DELETED<br><b>.</b><br><b>.</b><br><b>.</b></pre>
<hr>
<p>If you have programmer access, you are also presented with the
"AUDIT CONDITION:" prompt. Here, you can restrict the data entries that
will be audited. Enter a line of M code that must evaluate true or
false. If it evaluates true, an audit record of the value change is
made. Otherwise, no auditing is done for that data entry. (See the "<a href="../pm/afd_frm.htm" target="_top" title="Advanced File Definition" class="bodylink">Advanced
File Definition</a>" chapter in the "<a href="../pm/index.htm" target="_top" title="VA FileMan V. 22.0 Programmer HTML Manual" class="bodylink">VA FileMan Programmer Manual</a>" for
more information on the audit condition.) </p>
<p><b>NOTE:</b> If auditing is not turned on for the
field with a YES or EDITED answer to the "AUDIT:" prompt, the field
will not be audited, even if code is entered at the "AUDIT CONDITION:"
prompt. </p>
<p><span class="badge">22.2</span>Fields
with
a Data Type of COMPUTED&nbsp;cannot be audited, but all other types
of fields, including WORD-PROCESSING fields, are auditable..
</p>
<p>In order to initiate an audit of data fields or of a data
dictionary, you must have AUDIT access to the files you want to audit.
(See the "<a href="ds_frm.htm" target="_top" title="Data Security" class="bodylink">Data Security</a>"
chapter for more information about AUDIT access.) </p>
<hr>
<h5><big><big><a name="Turning">Turning
Data Field Audit On/Off</a></big></big></h5>
<p>Users who do not have the Modify File Attributes option (DD
access) to files can be given the Turn Data Audit On/Off option. This
option is found on VA FileMan's Auditing submenu. It is used to begin
or end an audit trail for fields. The user must have AUDIT access to
the file to set data audits. No other access is necessary. The Turn
Data Audit On/Off option is called DIAUDIT TURN ON/OFF; it can be
granted to users with Kernel's menu management options. No other
attributes in the field definition can be affected by use of this
option. </p>
<p>Use of Turn Data Audit On/Off is very similar to using the
Modify File Attributes option: </p>
<hr>
<pre>Select OPTION: <b>OTHER</b> OPTIONS <br>Select OTHER OPTION: <b>AUDITING</b><br>Select AUDITING OPTION: <b>TURN</b> DATA AUDIT ON/OFF<br>AUDIT FROM WHAT FILE: <b>PATIENT</b><br>Select FIELD: <b>DATE OF BIRTH</b><br>AUDIT: <b>EDITED</b> OR DELETED</pre>
<hr>
<p>To end the audit trail, simply re-enter the Turn Data Audit
On/Off option and turn the audit off by entering NO at the "AUDIT:"
prompt: </p>
<hr>
<pre>AUDIT: EDITED OR DELETED// <b>NO </b> NO</pre>
<hr>
<h5><big><big><a name="Reviewing">Reviewing
the Data Field
Audit Trail</a></big></big></h5>
<p><strong>1. CAPTIONED output with audit trail</strong></p>
<p>There are a number of different ways to retrieve audit
information.&nbsp; The simplest is to examine all the audited past
values for a particular entry, or a set of entries.&nbsp; Let's say
we are reviewing Patient entries in the PATIENT file.&nbsp; Using
either the Inquire to File Entries or the Print File Entries options,
we specify the [CAPTIONED] output.&nbsp; If the file has audited
data on record, we will be asked whether we want to see the audit trail
on the patient(s) displayed. </p>
<p>Suppose the PATIENT file has been edited so that patient
'Green' was first assigned a DOB of 1/20/49, but that subsequently this
DOB was changed to 1/20/50. </p>
<hr>
<pre>Select OPTION: <b>INQ</b>UIRE TO FILE ENTRIES&nbsp;<br><br>OUTPUT FROM WHAT FILE: <b>PATIENT</b>&nbsp;&nbsp;<br>Select PATIENT: <b>GREEN,RICHARD<br></b>ANOTHER ONE: <br><br>STANDARD CAPTIONED OUTPUT? Yes//&nbsp;<b></b> (Yes)<br>Include COMPUTED fields:&nbsp; (N/Y/R/B): NO//&nbsp;<b></b><br> - No record number (IEN), no Computed<br>&nbsp;Fields<br>DISPLAY AUDIT TRAIL? No// <br><b>YES</b><br>NAME: GREEN, RICHARD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DOB: JAN 20, 1950<br><br>&nbsp;&nbsp;&nbsp; Changed from "JAN 20, 1949" on Mar 15, 2001@16:48:53 by User #16<br><br>&nbsp;&nbsp;&nbsp; Created on Mar 13, 2001@19:41:36 by User #330</pre>
<hr>
<p><span class="badge">22.2</span><strong>2. Showing Changes by a Specific User</strong></p>
<p>We may want to look at the audit trail by user rather than by
entry.
&nbsp; &#8220;MONITOR A USER&#8221; is now the second auditing option. It shows
every entry in a specified audited file touched by a given
user.&nbsp;</p>
Suppose we want to see all entries in File 2 that have been seen by a
given User since the beginning of 2016.<br>
<br>
<pre>Select AUDIT OPTION:&nbsp;&nbsp;&nbsp; MONITOR A USER<br><br>Select a USER who has signed on to this system:&nbsp;&nbsp;&nbsp;TIMSON,GEORGE&nbsp;&nbsp;&nbsp;&nbsp; GFT&nbsp;<br><br>Select AUDITED File: PATIENT<br><br>START WITH DATE: FIRST// 1 1&nbsp; (JAN 01, 2016)<br><br><br>PATIENT RECORDS ACCESSED BY TIMSON,GEORGE (DUZ=1)&nbsp; SINCE JAN 1,2016&nbsp;&nbsp;&nbsp;&nbsp; Page 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EARLIEST ACCESS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LATEST ACCESS<br>--------------------------------------------------------------------------------<br>AMUFNI,THRHFGMH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>4-26-79&nbsp;&nbsp; CLI666465289&nbsp;&nbsp; Female<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APR 22,2016@09:02:19<br>GV,XGS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>5-13-62&nbsp;&nbsp; CLI666315991&nbsp;&nbsp; Female<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JAN 28,2016@12:08:35&nbsp;&nbsp;&nbsp;&nbsp; APR 17,2016@09:39:23<br>SIPOUOSH,INPNN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>8-4-33&nbsp;&nbsp;&nbsp; CLI666352931&nbsp;&nbsp;Male<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JAN 9,2016@09:38:23&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APR 17,2016@12:00:57</pre>
<hr>
<p><strong>3. Computed-Field FUNCTIONS for retrieving audit
		changes</strong></p> 
	 <p>Three powerful&nbsp;FUNCTIONS now allow retrieval of audit data.&nbsp; As
		with all Computed Expressions, use of these Functions is in the context of a
		given entry in a given (audited) file.&nbsp; <br>&nbsp;&nbsp;&nbsp;
		<b>PRIORVALUE(Field_name)</b> returns values of the 'Field_name' field that
		existed before a change was made. <br>&nbsp;&nbsp;&nbsp;
		<b>PRIORDATE(Field_name)</b> returns the corresponding date/time at which a
		change to the field value was made. <br>&nbsp;&nbsp;&nbsp;
		<b>PRIORUSER(Field_name)</b> returns the corresponding user number ('DUZ') who
		made the change to the field value.</p> 
	 <p>Each of these Functions is multi-valued, since the Field value for the
		entry may have been changed more than once in the past. The Functions "1ST",
		"2ND", "LAST", "COUNT" can be used with these multiples.&nbsp; Thus, the
		Computed Expression <b>COUNT(PRIORVALUE(NAME))&gt;4</b> means "the NAME on this
		entry has been changed more than four times in the past".&nbsp; To find any
		entry whose NAME <u>used to contain</u> "CLINTON", search for&nbsp;&nbsp;&nbsp;
		<b>PRIORVALUE(NAME)["CLINTON"]</b>. </p> <hr> 
	 <p><strong>4. The AUDIT File</strong></p> 
	 <p>A more specialized way to examine audits is to query the AUDIT file
		(#1.1) to obtain audit information. The set of all past audited events for a
		given FileMan file is itself a FileMan file, which can be queried or printed.
		The entries are identified first by their internal entry number in the AUDIT
		file, then by the internal entry number of the edited entry from the file being
		audited, and finally by the date/time of the audited event. Suppose
        'GREEN,RICHARD' is the 355th entry in the PATIENT file.</p>
        <pre>OUTPUT FROM WHAT FILE: PATIENT// <b>1.1  </b> AUDIT<br>AUDIT FROM WHAT FILE: PATIENT//&nbsp;<b></b><br>&nbsp;elect PATIENT AUDIT: <b>1&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp; 355&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3-15-2001@16:48:53<br>ANOTHER ONE:&nbsp;&nbsp;<br>STANDARD CAPTIONED OUTPUT? YES//&nbsp;<b></b> (YES)&nbsp;<br>DISPLAY COMPUTED FIELDS? NO// <b>Y </b>(YES)</pre> <hr> 
	 <p> Responding with YES at the "DISPLAY COMPUTED FIELDS? NO//" prompt shows
		the AUDIT file's COMPUTED fields: ENTRY NAME, FIELD NAME, OLD VALUE, and NEW
		VALUE. A NO response will <i>not</i> show these fields.</p> 
	 <p>The following output is produced:</p>
     <pre>NUMBER: 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
INTERNAL ENTRY NUMBER: 355<br>  DATE/TIME RECORDED: JAN 06, 2003@12:42:08&nbsp;<br>  FIELD NUMBER: 2&nbsp;&nbsp;&nbsp;              USER: PHARMACY,TECH<br>  OLD INTERNAL VALUE: 2490120     DATATYPE OF OLD VALUE: Da<br>  NEW INTERNAL VALUE: 2500120     DATATYPE OF NEW VALUE: Da  <br>  ENTRY NAME (c):&nbsp;GREEN,RICHARD   FIELD NAME (c): DATE<br>  OLD VALUE (c): JAN 06, 2003     NEW VALUE (c): FEB 03, 2003</pre> <hr> 
	 <p> If you deleted Green's DATE OF BIRTH, the corresponding entry in File
		#1.1 would show the NEW VALUE as &lt;deleted&gt;. If the entire entry for Green
		were deleted, there would be no value for the ENTRY NAME field in any of the
		audit listings for that entry.&nbsp; The last audit entry would show
		&lt;deleted&gt; for the NEW VALUE of the DATE OF BIRTH field.</p> 
	 <p>Since the entries in the Audit file can be sorted just as flexibly as
		those in any other FileMan file, you could easily, for example, search for all
		audits that occurred between a range of DATE/TIME RECORDED values.</p> <hr> 
	 <p><big><strong><a name="Tracking">Tracking Data Field Audits</a></strong></big></p> 
	 <p>Use the Fields Being Audited option to list the audited fields from a
		file or a specified range of files. After selecting the Fields Being Audited
		option, give a file (or a range) at the "START WITH WHAT FILE:" and "GO TO WHAT
		FILE:" prompts. You receive a report with the file number, field number, field
		name, type of field being audited, and the type of audit being performed.</p> 
	 <p>The listing below shows all fields flagged for auditing in a file
		range:</p>
     <pre>AUDITED FIELDS                   JAN 20, 2002   10:10   PAGE 1<br> <br>FILE       NUMBER       LABEL            TYPE        AUDIT<br>---------------------------------------------------------------------<br><br>16        2             DOB               DATE/TIME  YES, ALWAYS<br>40.5      10            LOCATION          POINTER    EDITED OR DELETED<br>1036      1             SEX               SET        EDITED OR DELETED<br>1036      7
SSN               FREE TEXT  YES, ALWAYS </pre><hr> 
	 <p><big><strong><a name="Purging">Purging a Data Field Audit
		Trail</a></strong></big></p> 
	 <p>Use the Purge Data Audits option to purge the audit trail. It will purge
		the records used for auditing data fields for a specified file. Purging audit
		trails is not an automatic feature; it must be done manually.</p> 
	 <p>You should either 1) turn auditing off on the files you're purging while
		you're doing the purge, or 2) leave auditing on but purge the file when not
		many users are on the system. If you purge when auditing is on and people are
		using the file in question, it is possible that you might end up with
		incomplete audit records on the audited file. </p> 
	 <p><b>NOTE:</b> Purged audit records cannot be recovered! </p> 
	 <p>The following dialogue illustrates purging <i>selected</i> records from
		the audit trail: </p> 
     <pre>Select OPTION: <b>OTHER</b> <br>Select OTHER OPTION: <b>AUDITING</b>
<br>Select AUDIT OPTION: <b>PURGE DATA AUDITS</b>
<br>AUDIT FROM WHAT FILE: <b>PATIENT</b>
<br>DO YOU WANT TO PURGE ALL DATA AUDIT RECORDS?  NO//&nbsp;</pre>
	 <p>Answering NO to the&nbsp;</p><p>&nbsp; "DO YOU WANT TO PURGE ALL DATA AUDIT RECORDS? NO//"&nbsp;</p><p>prompt allows you to specify which entries to purge.</p> 
     <pre>PURGE AUDIT RECORDS BY: INTERNAL ENTRY NUMBER// <b>??</b><br>&nbsp;Choose from:
   .001         NUMBER
   <br>.01          INTERNAL ENTRY NUMBER
   <br>.02          DATE/TIME RECORDED
   <br>.03          FIELD NUMBER
   <br>.04          USER
   <br>.05          RECORD ADDED<br>.....</pre>
	 <p>You can specify which records to purge by referencing any field in the
		AUDIT file. You can select the records by using the same criteria available at
		the "SORT BY:" prompt. See the "<a href="../u1/pr_intro.htm#specifying_sort" target="_top" title="Print: How to Print Reports from Files" class="bodylink">Print: How to Print Reports from Files</a>" chapter of the "<a href="../u1/index.htm" target="_top" title="VA FileMan V. 22.0 Getting Started HTML Manual" class="bodylink">VA
		FileMan Getting Started Manual</a>" for more details. </p>
     <pre>PURGE AUDIT RECORDS BY: INTERNAL ENTRY NUMBER// <b>USER</b>
<br>START WITH USER:  FIRST// <b>CHIEFTAIN</b>
<br>GO TO USER: LAST// <b>CHIEFTAIN</b> <br>  WITHIN USER, PURGE AUDIT RECORDS BY:<br>DEVICE:......
 <br><br>PURGE OF AUDIT DATA:  PATIENT      FEB 21, 2002   13:26    PAGE 1<br>&nbsp;------------------------------------------------------------------<br><br>&nbsp;4 RECORDS PURGED.</pre>
	 <p>The following dialogue purges <i>all</i> records from the PATIENT file's
     audit trail: </p>
     <pre>AUDIT FROM WHAT FILE: <b>PATIENT</b>
DO YOU WANT TO PURGE ALL DATA AUDIT RECORDS?  NO// <b>YES</b> <br>ARE YOU SURE?  NO// <b>YES</b> <br><br>DELETED</pre>
	 <p>&nbsp;</p> 
	 <hr class="hrstyle">
	 <p align="center">Reviewed/Updated: October 2016</p>
	 <p>&nbsp;</p>
</body></html>
